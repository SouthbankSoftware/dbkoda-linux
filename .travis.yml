# @Author: Guan Gui <guiguan>
# @Date:   2018-01-24T14:35:24+11:00
# @Email:  root@guiguan.net
# @Last modified by:   guiguan
# @Last modified time: 2018-01-25T16:59:57+11:00
#
# dbKoda - a modern, open source code editor, for MongoDB.
# Copyright (C) 2017-2018 Southbank Software
#
# This file is part of dbKoda.
#
# dbKoda is free software: you can redistribute it and/or modify
# it under the terms of the GNU Affero General Public License as
# published by the Free Software Foundation, either version 3 of the
# License, or (at your option) any later version.
#
# dbKoda is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Affero General Public License for more details.
#
# You should have received a copy of the GNU Affero General Public License
# along with dbKoda.  If not, see <http://www.gnu.org/licenses/>.

os: linux
dist: trusty
sudo: required
language: node_js
# Node version specified in .nvmrc
node_js: null
jdk: openjdk8

git:
  depth: 3
  submodules: false

before_install:
  - git submodule update --init --recursive --recommend-shallow --remote

install:
  - node -v
  - java -version
  - python --version

script:
  - set -e


deploy:
  provider: s3
  access_key_id: $AWS_ACCESS_KEY_ID
  secret_access_key: $AWS_SECRET_ACCESS_KEY
  bucket: cloud-build
  skip_cleanup: true
  local_dir: dbkoda/dist/s3
  region: ap-southeast-2

notifications:
  slack:
    secure: OdG93rGUGne86ZuMmg1BzwZR9Dy2Bbl2vt0aPbGuTiRQ+QJ3OUQ+MLA72ubMKeQ2oIo0O+AqCNhK3c+8dmHoGJHXLzsHh06NmrG/hK8rts5nbcNOsEFFMw3sx/uGmYE3Mjf5YygWIaY9ct2elHD88qGbjz+gfeOzXP56uRdCDRJVsx1miY6H3cjhkPTiuz7dKolt07tRfTLdA11zlFUJeZOQcaO5LUOoJsyfNMvP/Yd9oFXZdhDzx6e7fiT1Eaptvsd7hkpdVDXH51gjMgL+uu5X5/VLIGpaTHHNGrEDDSYTgUnrXQXD+k+YJ7o496CnvF2SkMD9ZkVOiIWZX75z9Z6unGmLnG0QpH9fXj0DqG2pCtvVOdfASsSk7ONWR2/lKLqCi+Rq/qN/DP2OfbFrmPsqBjv2VyM9BqPiGlZZVC/tOATix2moCZbEj7Wh6RsYeEevaqhxP1TWhzoMkGFkTCvYU6Njm215DaPGjHL5tX2ahAsqM26HSnXmjLCNeWj1h5vXq4wZ55JQBDL/kgQiaJxihl4r9kFMgPT+VLaOgVrRnSO8xqG8XrqfKDYAQMqwnlDyGJIPGYHCXxhPvGa0b5OjEKUlGWOTiiBTfjR7hBMjcYtEM46XK96GdfS7nyVcbCYedAM3t9txzyCU5aPme+TGfpcoeo0lT59XsX7ky0U=
  email: false
  template:
    - "Linux cloud build <%{build_url}|#%{build_number}> (<%{compare_url}|%{commit}>) by %{author} %{result} in %{duration}: %{message}"
